
version: 2

metrics:
  - name: revenue
    label: Revenue
    model: ref('fct_orders')
    description: "Income from all orders less tax"

    type: sum
    sql: gross_item_sales_amount - item_tax_amount

    timestamp: order_date
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - status_code
      - priority_code

  - name: customers
    label: Customers
    model: ref('fct_orders')
    description: "Number of customers with a sale"

    type: count_distinct
    sql: customer_key

    timestamp: order_date
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - priority_code

  - name: discounts
    label: Discounts
    model: ref('fct_orders')
    description: "Total discount amount per order"

    type: sum
    sql: item_discount_amount

    timestamp: order_date
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - status_code
      - priority_code

  - name: gross_profit
    label: Gross Profit
    description: "Revenue minus expenses"

    type: expression
    sql: "{{ metric('revenue') }} - {{ metric('discounts') }}"

    timestamp: ordered_date
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - status_code
      - priority_code
